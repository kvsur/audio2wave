!function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";var i;n.r(e),function(t){t[t.LEFT=0]="LEFT",t[t.CENTER=1]="CENTER",t[t.RIGHT=2]="RIGHT"}(i||(i={}));var o=function(){return(o=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},r={color:"rgb(61 126 154)",barWidth:2,align:i.LEFT,xSpace:2},s=function(){function t(t,e,n){var i=this;this.height=0,this.width=0,this.drawing=!1,this.heightScale=0,this.run=function(){},this.innerRun=function(){i.beforeDraw(),i.draw(),requestAnimationFrame(i.run)},this.config=o(o({},r),n),this.container=t,this.fftSize=e,this.init()}return t.prototype.init=function(){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.setCanvasSize(),this.container.appendChild(this.canvas),this.context.translate(0,this.height/2),window.addEventListener("resize",this.setCanvasSize)},t.prototype.setCanvasSize=function(){var t=getComputedStyle(this.container);this.height=this.canvas.height=parseFloat(t.height),this.width=this.canvas.width=parseFloat(t.width),this.heightScale=this.height/2/(this.fftSize/2-1)},t.prototype.start=function(){this.drawing||(this.run=this.innerRun,this.run(),this.drawing=!0)},t.prototype.stop=function(){this.drawing&&(this.run=function(){},this.drawing=!1)},t.prototype.draw=function(){this.context.clearRect(0,-this.height/2,this.width,this.height),this.context.fillStyle=this.config.color,this.context.fillRect(0,0,this.width,this.config.barWidth);for(var t=this.waveData.length,e=0,n=0;e<t;e++){var i=this.waveData[e]*this.heightScale,o=-i;this.context.fillStyle=this.config.color,this.context.fillRect(n,o,this.config.barWidth,2*i),n+=this.config.barWidth+this.config.xSpace}},t.prototype.destroy=function(){return this.container.removeChild(this.canvas),this.canvas=null,this.context=null,window.removeEventListener("resize",this.setCanvasSize),Promise.resolve()},t}(),a=function(t,e){this.eventName=t,this.data=e},u=function(){function t(){this.innerMap=new Map}return t.prototype.add=function(t,e){var n=this.innerMap.get(t);n||(n=new Set,this.innerMap.set(t,n)),n.add(e)},t.prototype.set=function(t,e){this.innerMap.set(t,new Set(e))},t.prototype.get=function(t){var e=this.innerMap.get(t);return e?Array.from(e):[]},t.prototype.getAll=function(){var t,e=new Array,n=this.innerMap.values();do{(t=n.next()).value.forEach((function(t){e.push(t)}))}while(!t.done);return e},t.prototype.delete=function(t){this.innerMap.delete(t)},t.prototype.deleteItem=function(t,e){var n=this.innerMap.get(t);n&&n.delete(e)},t.prototype.clear=function(){this.innerMap=new Map},t.prototype.itemSize=function(t){var e=this.innerMap.get(t);return e&&e.size||0},t.prototype.allItemSize=function(){var t,e=0,n=this.innerMap.values();do{var i=(t=n.next()).value;e+=i&&i.size}while(!t.done);return e},t.prototype.size=function(){return this.innerMap.size},t}(),c=function(){function t(){this.map=new u}return t.prototype.addListener=function(t,e){this.map.add(t,e)},t.prototype.removeListener=function(t,e){this.map.deleteItem(t,e)},t.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i=this.map.get(t);try{i.forEach((function(t){t.apply(void 0,e)}))}catch(t){console.error(t)}},t}(),h={fftSize:512},d=function(){function t(t,e){void 0===e&&(e=h),this.state="suspended",this.audio=t,this.config=e,this.init()}return t.prototype.init=function(){var t=this;this.emitor=new c,this.audioContext=this.createAudioContext(),this.audioContext.onstatechange=function(e){t.state=e.target.state,t.emitor.emit("statchange",new a("statechange",t.state))}},t.prototype.createAudioContext=function(){if(window.AudioContext)return new AudioContext;if(window.webkitAudioContext)return new webkitAudioContext;throw new Error("当前浏览器版本不支持AudioContext和webkitAudioContext，请升级或者更换浏览器")},t.prototype.getByteFrequenceData=function(){this.analyser.getByteFrequencyData(this.byteFrequencyData)},t.prototype.start=function(){this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=this.config.fftSize||512;var t=this.analyser.frequencyBinCount;return this.byteFrequencyData=new Uint8Array(t),this.audioSource=this.audioContext.createMediaElementSource(this.audio),this.audioSource.connect(this.analyser),this.analyser.connect(this.audioContext.destination),this.audioContext.resume()},t.prototype.stop=function(){var t=this;return this.analyser.disconnect(),this.audioSource.disconnect(),this.audioContext.suspend().catch((function(e){t.emitor.emit("error",new a("error",e))})).finally((function(){t.analyser=null,t.audioSource=null})),Promise.resolve()},t.prototype.destroy=function(){var t=this;return this.stop().finally((function(){t.audioContext.close(),t.audioContext=null,t.emitor.emit("destroy",new a("destroy",null))})),Promise.resolve()},t.prototype.addEventListener=function(t,e){this.emitor.addListener(t,e)},t.prototype.removeEventListener=function(t,e){this.emitor.removeListener(t,e)},t}(),p=function(){function t(t){this.config=t;var e=t.dataConfig&&t.dataConfig.fftSize||512;this.drawer=new s(t.container,e,t.drawerConfig),this.processer=new d(t.audio,t.dataConfig)}return t.prototype.start=function(){var t=this;this.drawer.beforeDraw=function(){t.processer.getByteFrequenceData(),t.drawer.waveData=t.processer.byteFrequencyData.slice(0)},this.processer.start(),this.drawer.start()},t.prototype.stop=function(){this.drawer.stop(),this.processer.stop()},t.prototype.destroy=function(){return this.drawer.destroy(),this.processer.destroy(),Promise.resolve()},t}();const f=document.getElementById("audio"),l=new p({audio:f,container:document.getElementById("container")});f.onplaying=()=>{l.start()},f.onpause=()=>{l.stop()},window.onunload=()=>{l.destroy()}}]);